<!DOCTYPE html>
<html lang="he">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>קופונים</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    text-align: center;
    direction: rtl;
    margin: 0;
    padding: 20px;
    background-color: #f0f0f0;
    color: #333;
  }

  h1 {
    margin-bottom: 10px;
    color: #2c3e50;
    font-size: 28px;
  }

  h4 {
    margin-bottom: 20px;
    color: #7f8c8d;
    font-size: 16px;
    font-weight: normal;
  }

  .button-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 15px;
    margin-top: 20px;
  }

  .coupon-button {
    padding: 15px;
    background-color: #777;
    color: #fff;
    border: none;
    cursor: pointer;
    border-radius: 8px;
    font-size: 16px;
    transition: all 0.3s ease;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    width: calc(50% - 15px);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  .coupon-button:hover {
    background-color: #555;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
  }

  .coupon-details {
    font-size: 12px;
    margin-top: 8px;
    color: #ccc;
  }

  .search-input {
    padding: 12px;
    font-size: 16px;
    border: 1px solid #999;
    border-radius: 8px;
    margin-bottom: 20px;
    width: 100%;
    max-width: 300px;
    transition: border-color 0.3s ease;
  }

  .search-input:focus {
    outline: none;
    border-color: #555;
  }

  @media (max-width: 600px) {
    .coupon-button {
      width: 100%;
    }
    
    h1 {
      font-size: 24px;
    }
    
    h4 {
      font-size: 14px;
    }
  }
</style>
</head>
<body>
<h1>שם זה זול יותר</h1>
<h4>חפש לפי חנות או שם מוצר</h4>

<input type="text" id="searchInput" class="search-input" placeholder='לדוגמא "המשביר" או "אוזניות גיימינג"'>
<div class="button-container" id="buttonContainer">
  <!-- Buttons will be added here dynamically -->
</div>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    let allSites = [];
    const buttonContainer = document.getElementById("buttonContainer");
    const searchInput = document.getElementById("searchInput");

    // Expanded Hebrew to English translation map
    const hebrewToEnglish = {
      'עלי': 'ali',
      'אקספרס': 'express',
      'עליאקספרס': 'aliexpress',
      'אלי': 'ali',
      'אמזון': 'amazon',
      'איביי': 'ebay',
      'אסוס': 'asos',
      'נקסט': 'next',
      'איקאה': 'ikea',
      'פוקס': 'fox',
      'זארה': 'zara',
      'המשביר': 'hamashbir',
      'גולף': 'golf',
      'קסטרו': 'castro',
      'רנואר': 'renuar',
      'אוזניות': 'headphones',
      'גיימינג': 'gaming',
      'מחשב': 'computer',
      'טלפון': 'phone',
      'סמארטפון': 'smartphone',
      'טלויזיה': 'television',
      'מסך': 'screen',
      'מקלדת': 'keyboard',
      'עכבר': 'mouse',
      'רמקול': 'speaker',
      'מצלמה': 'camera',
      'שעון': 'watch',
      'חכם': 'smart',
      'ביגוד': 'clothing',
      'הנעלה': 'shoes',
      'תיק': 'bag',
      'ארנק': 'wallet',
      'תכשיט': 'jewelry',
      'ספר': 'book',
      'צעצוע': 'toy',
      'מזון': 'food',
      'קוסמטיקה': 'cosmetics',
      'ריהוט': 'furniture',
      'כלי בית': 'home appliances'
    };

    // Fetch data from the API
    fetch("https://o0rmue7xt0.execute-api.il-central-1.amazonaws.com/dev/sites")
    .then(response => response.json())
    .then(data => {
      // Store all sites without filtering
      allSites = data;
    })
    .catch(error => console.error("Error fetching data:", error));

    // Function to translate Hebrew to English
    function translateQuery(query) {
      return query.split(' ').map(word => hebrewToEnglish[word.toLowerCase()] || word).join(' ');
    }

    // Function to filter sites based on search query
    function filterSites(query) {
      const translatedQuery = translateQuery(query.toLowerCase());
      const filteredSites = allSites.filter(site => {
        return (
          site.siteName.toLowerCase().includes(translatedQuery) ||
          site.siteCategory.toLowerCase().includes(translatedQuery) ||
          (site.cuponDetails && site.cuponDetails.toLowerCase().includes(translatedQuery)) ||
          site.siteName.toLowerCase().includes(query.toLowerCase()) ||
          site.siteCategory.toLowerCase().includes(query.toLowerCase()) ||
          (site.cuponDetails && site.cuponDetails.toLowerCase().includes(query.toLowerCase()))
        );
      });

      // Sort sites: those with coupons first, then alphabetically
      filteredSites.sort((a, b) => {
        if (a.cupon && !b.cupon) return -1;
        if (!a.cupon && b.cupon) return 1;
        return a.siteName.localeCompare(b.siteName);
      });

      // Remove duplicates based on siteName
      const uniqueSites = filteredSites.reduce((acc, current) => {
        const x = acc.find(item => item.siteName === current.siteName);
        if (!x) {
          return acc.concat([current]);
        } else {
          return acc;
        }
      }, []);

      return uniqueSites;
    }

    // Function to render buttons for the filtered sites
    function renderButtons(sites) {
      buttonContainer.innerHTML = "";
      sites.forEach(site => {
        const button = document.createElement("button");
        button.textContent = site.siteName;
        button.className = "coupon-button";
        if (site.cuponDetails) {
          const details = document.createElement("div");
          details.className = "coupon-details";
          details.textContent = site.cuponDetails;
          button.appendChild(details);
        }
        button.addEventListener("click", function() {
          if (site.cupon) {
            // Copy cupon to clipboard
            navigator.clipboard.writeText(site.cupon).then(() => {
              console.log('Coupon copied to clipboard');
            }).catch(err => {
              console.error('Failed to copy: ', err);
            });
          }
          // Open in new tab
          window.open(site.affLink || site.URL, '_blank');
        });
        buttonContainer.appendChild(button);
      });
    }

    // Event listener for search input
    searchInput.addEventListener("input", function(event) {
      const query = event.target.value.trim();
      if (query) {
        const filteredSites = filterSites(query);
        renderButtons(filteredSites);
      } else {
        buttonContainer.innerHTML = "";
      }
    });
  });
</script>
</body>
</html>